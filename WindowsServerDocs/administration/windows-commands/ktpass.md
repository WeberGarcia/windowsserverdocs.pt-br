---
title: ktpass
description: Tópico de comandos do Windows para * * * *-
ms.prod: windows-server
ms.technology: manage-windows-commands
ms.topic: article
ms.assetid: 47087676-311e-41f1-8414-199740d01444
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/16/2017
ms.openlocfilehash: de74d04ceaca0147b4d12cd9c0eaacbf233e2fd7
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/08/2020
ms.locfileid: "80841209"
---
# <a name="ktpass"></a>ktpass

>Aplicável a: Windows Server (canal semestral), Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

Configura o nome principal do servidor para o host ou serviço nos serviços de domínio Active Directory (AD DS) e gera um arquivo. keytab que contém a chave secreta compartilhada do serviço. O arquivo .keytab baseia-se na implementação do protocolo de autenticação Kerberos pelo MIT (Massachusetts Institute of Technology). A ferramenta de linha de comando ktpass permite que serviços não Windows que dão suporte à autenticação Kerberos usem os recursos de interoperabilidade fornecidos pelo serviço de centro de distribuição de chaves Kerberos (KDC). Este tópico aplica-se às versões do sistema operacional designadas na lista **aplica-se a** no início do tópico.  

## <a name="syntax"></a>Sintaxe  
```  
ktpass  
[/out <FileName>]   
[/princ <PrincipalName>]   
[/mapuser <UserAccount>]   
[/mapop {add|set}] [{-|+}desonly] [/in <FileName>]  
[/pass {Password|*|{-|+}rndpass}]  
[/minpass]  
[/maxpass]  
[/crypto {DES-CBC-CRC|DES-CBC-MD5|RC4-HMAC-NT|AES256-SHA1|AES128-SHA1|All}]  
[/itercount]  
[/ptype {KRB5_NT_PRINCIPAL|KRB5_NT_SRV_INST|KRB5_NT_SRV_HST}]  
[/kvno <KeyversionNum>]  
[/answer {-|+}]  
[/target]  
[/rawsalt] [{-|+}dumpsalt] [{-|+}setupn] [{-|+}setpass <Password>]  [/?|/h|/help]  
```  
### <a name="parameters"></a>Parâmetros  

|                                             Parâmetro                                              |                                                                                                                                                                                                                                                                                                      Descrição                                                                                                                                                                                                                                                                                                       |
|----------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                          /out <FileName>                                           |                                                                                                                                                                        Especifica o nome do arquivo Kerberos versão 5. keytab a ser gerado. **Observação:** Esse é o arquivo. keytab que você transfere para um computador que não está executando o sistema operacional Windows e, em seguida, substitui ou mescla com o arquivo. keytab existente,/Etc/Krb5.keytab.                                                                                                                                                                        |
|                                       <PrincipalName>/princ                                       |                                                                                                                                                                                                                   Especifica o nome da entidade de segurança no formato host/computer.contoso.com@CONTOSO.COM. **AVISO:** Esse parâmetro diferencia maiúsculas de minúsculas. Consulte [comentários](#BKMK_remarks) para obter mais informações.                                                                                                                                                                                                                    |
|                                       <UserAccount>/mapuser                                       |                                                                                                                                                                                                                                                Mapeia o nome da entidade de segurança Kerberos, que é especificada pelo parâmetro **princ** , para a conta de domínio especificada.                                                                                                                                                                                                                                                |
|                                       /mapop {adicionar&#124;conjunto}                                        |                                                                                                                                                                             Especifica como o atributo de mapeamento é definido.<p>-   **Adicionar** adiciona o valor do nome de usuário local especificado. Este é o padrão.<br />-   **conjunto** define o valor da criptografia somente des (padrão de criptografia de dados) para o nome de usuário local especificado.                                                                                                                                                                             |
|                                         {-&#124;+} desonly                                          |                                                                                                                                                            A criptografia somente DES é definida por padrão.<p>-    **+** define uma conta para criptografia somente des.<br />-    **-** restrição de versões em uma conta para criptografia somente des. **Importante:** A partir do Windows 7 e do Windows Server 2008 R2, o Windows não oferece suporte a DES por padrão.                                                                                                                                                            |
|                                           <FileName>/in                                           |                                                                                                                                                                                                                                                       Especifica o arquivo. keytab para ler de um computador host que não esteja executando o sistema operacional Windows.                                                                                                                                                                                                                                                        |
|                          /Pass {password&#124;\*&#124;{-&#124;+} rndpass}                           |                                                                                                                                                                                                                                           Especifica uma senha para o nome de usuário principal que é especificado pelo parâmetro **princ** . Use \* para solicitar uma senha.                                                                                                                                                                                                                                            |
|                                              /minpass                                              |                                                                                                                                                                                                                                                                            Define o comprimento mínimo da senha aleatória para 15 caracteres.                                                                                                                                                                                                                                                                            |
|                                              /maxpass                                              |                                                                                                                                                                                                                                                                           Define o comprimento máximo da senha aleatória como 256 caracteres.                                                                                                                                                                                                                                                                            |
| /crypto {DES-CBC-CRC&#124;des-CBC-MD5&#124;RC4-HMAC-NT&#124;aes256-SHA1&#124;aes128-SHA1&#124;All} | Especifica as chaves que são geradas no arquivo keytab:<p>-   **des-CBC-CRC** é usado para compatibilidade.<br />-   o **des-CBC-MD5** segue mais de acordo com a implementação do MIT e é usado para compatibilidade.<br />-   **RC4-HMAC-NT** emprega a criptografia de 128 bits.<br />-   **aes256-SHA1** emprega a criptografia aes256-CTS-HMAC-SHA1-96.<br />-   **aes128-SHA1** emprega a criptografia aes128-CTS-HMAC-SHA1-96.<br />-   **todos os** Estados que todos os tipos de criptografia com suporte podem ser usados. **Observação:** As configurações padrão são baseadas em versões mais antigas do MIT. Portanto, `/crypto` sempre deve ser especificado. |
|                                             /itercount                                             |                                                                                                                                                                                                                        Especifica a contagem de iterações que é usada para criptografia AES. O padrão é que **itercount** é ignorado para criptografia não AES e definido em 4.096 para criptografia AES.                                                                                                                                                                                                                         |
|               /pType {KRB5_NT_PRINCIPAL&#124;KRB5_NT_SRV_INST&#124;KRB5_NT_SRV_HST}                |                                                                                                                                                                                         Especifica o tipo de entidade de segurança.<p>-   **KRB5_NT_PRINCIPAL** é o tipo de entidade de segurança geral (recomendado).<br />-   **KRB5_NT_SRV_INST** é a instância do serviço de usuário.<br />-   **KRB5_NT_SRV_HST** é a instância do serviço de host.                                                                                                                                                                                         |
|                                       <KeyversionNum>/kvno                                        |                                                                                                                                                                                                                                                                               Especifica o número de versão da chave. O valor padrão é 1.                                                                                                                                                                                                                                                                                |
|                                         /Answer {-&#124;+}                                         |                                                                                                                                                                                                                    Define o modo de resposta de segundo plano:<p>**-** Respostas redefinem prompts de senha automaticamente sem.<p>**+** Respostas redefinem prompts de senha automaticamente com Sim.                                                                                                                                                                                                                     |
|                                              /target                                               |                                                                                                                                                                                           Define qual controlador de domínio usar. O padrão é que o controlador de domínio seja detectado, com base no nome principal. Se o nome do controlador de domínio não for resolvido, uma caixa de diálogo solicitará um controlador de domínio válido.                                                                                                                                                                                           |
|                                              /rawsalt                                              |                                                                                                                                                                                                                                                           força o ktpass a usar o algoritmo rawsalt ao gerar a chave. Esse parâmetro não é necessário.                                                                                                                                                                                                                                                            |
|                                         {-&#124;+} dumpsalt                                         |                                                                                                                                                                                                                                                           A saída desse parâmetro mostra o algoritmo parâmetro de Salt do MIT que está sendo usado para gerar a chave.                                                                                                                                                                                                                                                            |
|                                          {-&#124;+} instalação                                          |                                                                                                                                                                                                                                          Define o UPN (nome principal do usuário), além do SPN (nome da entidade de serviço). O padrão é definir ambos no arquivo. keytab.                                                                                                                                                                                                                                           |
|                                    <Password> de&#124;{-+} setpass                                    |                                                                                                                                                                                                                                                          Define a senha do usuário quando fornecida. Se rndpass for usado, uma senha aleatória será gerada em vez disso.                                                                                                                                                                                                                                                           |
|                                       /? &#124;/h&#124;/Help                                        |                                                                                                                                                                                                                                                                                         Exibe a ajuda de linha de comando para ktpass.                                                                                                                                                                                                                                                                                         |

## <a name="remarks"></a><a name=BKMK_remarks></a>Comentários  
Serviços em execução em sistemas que não executam o sistema operacional Windows podem ser configurados com contas de instância de serviço nos serviços de domínio Active Directory. Isso permite que qualquer cliente Kerberos se autentique em serviços que não estejam executando o sistema operacional Windows usando o Windows KDCs.  
O parâmetro/princ não é avaliado por ktpass e é usado como fornecido. Não há nenhuma verificação para ver se o parâmetro corresponde ao caso exato do valor do atributo **userPrincipalName** ao gerar o arquivo keytab. As distribuições Kerberos com distinção de maiúsculas e minúsculas usando esse arquivo keytab podem ter problemas quando não há nenhuma correspondência de maiúsculas e minúsculas e podem falhar durante a pré-autenticação. Verifique e recupere o valor correto do atributo **userPrincipalName** de um arquivo de exportação do LDifDE. Por exemplo:  
```  
ldifde /f keytab_user.ldf /d CN=Keytab User,OU=UserAccounts,DC=contoso,DC=corp,DC=microsoft,DC=com /p base /l samaccountname,userprincipalname  
```  
## <a name="examples"></a><a name=BKMK_examples></a>Disso  
O exemplo a seguir ilustra como criar um arquivo Kerberos. keytab, Machine. keytab, no diretório atual para o usuário Sample1. (Você mesclará esse arquivo com o arquivo krb5. keytab em um computador host que não esteja executando o sistema operacional Windows.) O arquivo Kerberos. keytab será criado para todos os tipos de criptografia com suporte para o tipo de entidade de segurança geral.  
Para gerar um arquivo. keytab para um computador host que não esteja executando o sistema operacional Windows, use as etapas a seguir para mapear a entidade de segurança para a conta e definir a senha da entidade de segurança do host:  
1.  Use o snap-in de usuários e computadores do Active Directory para criar uma conta de usuário para um serviço em um computador que não esteja executando o sistema operacional Windows. Por exemplo, crie uma conta com o nome Sample1.  
2.  Use ktpass para configurar um mapeamento de identidade para a conta de usuário digitando o seguinte em um prompt de comando:  
    ```  
    ktpass /princ host/Sample1.contoso.com@CONTOSO.COM /mapuser Sample1 /pass MyPas$w0rd /out Sample1.keytab /crypto all /ptype KRB5_NT_PRINCIPAL /mapop set   
    ```  

    > [!NOTE]  
    > Não é possível mapear várias instâncias de serviço para a mesma conta de usuário.  

3.  Mescle o arquivo. keytab com o arquivo/Etc/Krb5.keytab em um computador host que não esteja executando o sistema operacional Windows. 

## <a name="additional-references"></a>Referências adicionais  
- [Chave da sintaxe de linha de comando](command-line-syntax-key.md)  
